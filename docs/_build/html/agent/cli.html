

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Command Line Flags &mdash; Merlin BETA documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DLL Agent" href="dll.html" />
    <link rel="prev" title="FAQ" href="../quickStart/faq.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Merlin
          

          
          </a>

          
            
            
              <div class="version">
                0.8.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quick Start</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickStart/server.html">Merlin Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickStart/agent.html">Merlin Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickStart/faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Merlin Agent</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command Line Flags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#debug">Debug</a></li>
<li class="toctree-l2"><a class="reference internal" href="#host">Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ja3">JA3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#killdate">KillDate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#maxretry">MaxRetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#padding">Padding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proto">Proto</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proxy">Proxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#psk">PSK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skew">Skew</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sleep">Sleep</a></li>
<li class="toctree-l2"><a class="reference internal" href="#url">URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useragent">UserAgent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#verbose">Verbose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#version">Version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dll.html">DLL Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="powershell.html">PowerShell</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom.html">Custom Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="javascript.html">JavaScript Agent</a></li>
</ul>
<p class="caption"><span class="caption-text">Merlin Server</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server/menu/main.html">Main Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/menu/agents.html">Agent Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/menu/listeners.html">Listener Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/menu/modules.html">Modules Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server/x509.html">TLS Certificates</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/build.html">Building Modules</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc.</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/blogs.html">Blog Posts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/contrib.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/logging.html">Logging</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Merlin</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Command Line Flags</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/agent/cli.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="command-line-flags">
<h1>Command Line Flags<a class="headerlink" href="#command-line-flags" title="Permalink to this headline">¶</a></h1>
<p>The following command line flags can be used when executing Merlin agent:</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>Merlin Agent
  -debug
        Enable debug output
  -host string
        HTTP Host header
  -ja3 string
        JA3 signature string (not the MD5 hash). Overrides -proto flag
  -killdate string
        The date, as a Unix EPOCH timestamp, that the agent will quit running (default &quot;0&quot;)
  -maxretry string
        The maximum amount of failed checkins before the agent will quit running (default &quot;7&quot;)
  -padding string
        The maximum amount of data that will be randomly selected and appended to every message (default &quot;4096&quot;)
  -proto string
        Protocol for the agent to connect with [https (HTTP/1.1), http (HTTP/1.1 Clear-Text), h2 (HTTP/2), h2c (HTTP/2 Clear-Text), http3 (QUIC or HTTP/3.0)] (default &quot;h2&quot;)
  -proxy string
        Hardcoded proxy to use for http/1.1 traffic only that will override host configuration
  -psk string
        Pre-Shared Key used to encrypt initial communications (default &quot;merlin&quot;)
  -skew string
        Amount of skew, or variance, between agent checkins (default &quot;3000&quot;)
  -sleep string
        Time for agent to sleep (default &quot;30s&quot;)
  -url string
        Full URL for agent to connect to (default &quot;https://127.0.0.1:443&quot;)
  -useragent string
        The HTTP User-Agent header string that Agent will use while sending traffic (default &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.85 Safari/537.36&quot;)
  -v    Enable verbose output
  -version
        Print the agent version and exit
</pre></div>
</div>
<div class="section" id="debug">
<h2>Debug<a class="headerlink" href="#debug" title="Permalink to this headline">¶</a></h2>
<p>By default, the Merlin Agent will not write anything to STDOUT while it is running. The <code class="docutils literal notranslate"><span class="pre">-debug</span></code> flag enables debug output and facilitates troubleshooting to identify the source of a problem.</p>
</div>
<div class="section" id="host">
<h2>Host<a class="headerlink" href="#host" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-host</span></code> flag is used to specify the HTTP <em>Host:</em> header when communicating with the server. This feature is predominately used for <a class="reference external" href="https://attack.mitre.org/techniques/T1090/004/">Domain Fronting</a>.</p>
</div>
<div class="section" id="ja3">
<h2>JA3<a class="headerlink" href="#ja3" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967">JA3 is a method for fingerprinting TLS clients on the wire</a>. Every TLS client has a unique signature depending on its configuration of the following TLS options: <code class="docutils literal notranslate"><span class="pre">SSLVersion,Ciphers,Extensions,EllipticCurves,EllipticCurvePointFormats</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-ja3</span></code> flag allows the agent to create a TLS client based on the provided JA3 hash signature. This is useful to evade detections based on a JA3 hash for a known tool (i.e. Merlin). <a class="reference external" href="https://engineering.salesforce.com/gquic-protocol-analysis-and-fingerprinting-in-zeek-a4178855d75f">This</a> article documents a JA3 fingerprint for Merlin. Known JA3 signatures can be downloaded from <a class="reference external" href="https://ja3er.com/">https://ja3er.com/</a></p>
<p><strong>NOTE:</strong> Make sure the input JA3 hash will enable communications with the Server. For example, if you leverage a JA3 hash that only supports SSLv2 and the server does not support that protocol, then they will not be able to communicate. The <code class="docutils literal notranslate"><span class="pre">-ja3</span></code> flag will override the the <code class="docutils literal notranslate"><span class="pre">-proto</span></code> flag and will cause the agent to use the protocol provided in the JA3 hash.</p>
</div>
<div class="section" id="killdate">
<h2>KillDate<a class="headerlink" href="#killdate" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-killdate</span></code> flag is used to specify the date, as an Unix epoch timestamp, that the agent should quit running. <a class="reference external" href="https://www.epochconverter.com">EpochConverter</a> is a good resource to generate or convert a timestamp. The default value is <code class="docutils literal notranslate"><span class="pre">0</span></code> which means the Agent does not have a killdate.</p>
</div>
<div class="section" id="maxretry">
<h2>MaxRetry<a class="headerlink" href="#maxretry" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-maxretry</span></code> flag is the maximum amount of failed checkins before the agent will quit running. The default value is 7.</p>
</div>
<div class="section" id="padding">
<h2>Padding<a class="headerlink" href="#padding" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-padding</span></code> flag is maximum amount of data that will be randomly selected and appended to every message. The default value is 4096 bytes. The data padding is intended to increase the detection difficulty for idle checkin behavior when the message size was fixed everytime.</p>
</div>
<div class="section" id="proto">
<h2>Proto<a class="headerlink" href="#proto" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-proto</span></code> flag specifies what protocol the Merlin Agent will use to communicate with the server</p>
<p>The <code class="docutils literal notranslate"><span class="pre">http</span></code> protocol communicates using the clear-text HTTP/1.1 protocol. This can be useful when leveraging Domain Fronting on a CDN that does not allow both fronting and TLS encrypted traffic.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">https</span></code> protocol communicates using SSL/TLS encrypted HTTP/1.1 protocol.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">h2c</span></code> protocol communicates using the clear-text HTTP/2 protocol. This clear-text version is not used by web browsers like Chrome and may stand out during traffic analysis. However, it also has the potential to evade detections if allowed out of the network and no network defenses are able to parse the traffic.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">h2</span></code> protocol communicates using the TLS encrypted HTTP/2 protocol. This will start the connection with prior knowledge and will not negotiate from HTTP/1.1 to HTTP/2. Some web proxies will not allow HTTP/2 communications. In this case you should use <code class="docutils literal notranslate"><span class="pre">https</span></code>. Alternatively, the HTTP/2 protocol <em>might</em> bypass network defenses or detections.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">http3</span></code> protocol communicates using HTTP/2 transported over <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-quic-transport-28">QUIC</a> known as <a class="reference external" href="https://tools.ietf.org/html/draft-ietf-quic-http-29">HTTP/3</a>. It is important to note that QUIC is a UDP protocol and may not be allowed of the network depending on egress filtering. QUIC uses TLS transport encryption.</p>
</div>
<div class="section" id="proxy">
<h2>Proxy<a class="headerlink" href="#proxy" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-proxy</span></code> flag is used to force HTTP/1.1 communications to go through a known proxy. At this time the Merlin Agent <strong>WILL NOT</strong> automatically detect if a host is configured to use a proxy. The HTTP/2 protocol does not support using a proxy. If a proxy is required to egress a network, use the <code class="docutils literal notranslate"><span class="pre">http</span></code> or <code class="docutils literal notranslate"><span class="pre">https</span></code> protocols.</p>
</div>
<div class="section" id="psk">
<h2>PSK<a class="headerlink" href="#psk" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-psk</span></code> flag is used to specify the Pre-Shared Key (PSK) that the Merlin Agent uses to initiate communication with the Merlin Server. The first message is encrypted with the PSK and subsequent messages establish a new session based encryption key using the <a class="reference external" href="https://eprint.iacr.org/2018/163.pdf">OPAQUE protocol</a> from <a class="reference external" href="https://tools.ietf.org/html/draft-krawczyk-cfrg-opaque-03">this</a> IETF draft. Additional information about OPAQUE can be found here: <a class="reference external" href="https://posts.specterops.io/merlin-goes-opaque-for-key-exchange-420db3a58713">Merlin Goes OPAQUE for Key Exchange</a>.</p>
</div>
<div class="section" id="skew">
<h2>Skew<a class="headerlink" href="#skew" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-skew</span></code> flag is the amount of skew, or variance, between agent checkins. The default value is 3000</p>
</div>
<div class="section" id="sleep">
<h2>Sleep<a class="headerlink" href="#sleep" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-sleep</span></code> flag is used to specify how long the agent will sleep between checkin attempts. <strong>NOTE:</strong> You must include the unit of measurement after the number. For example, <code class="docutils literal notranslate"><span class="pre">30s</span></code> is for thirty seconds and <code class="docutils literal notranslate"><span class="pre">1m</span></code> is for one minute.</p>
</div>
<div class="section" id="url">
<h2>URL<a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-url</span></code> flag is used to specify the Uniformed Resource Locator (URL) that the agent will attempt to communicate with. Include the protocol (i.e. <code class="docutils literal notranslate"><span class="pre">https</span></code>), the host (i.e. <code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>), the page (i.e <code class="docutils literal notranslate"><span class="pre">/</span></code> or <code class="docutils literal notranslate"><span class="pre">/news.php</span></code>), and optionally port (i.e. <code class="docutils literal notranslate"><span class="pre">:443</span></code>). This will result in <code class="docutils literal notranslate"><span class="pre">https://127.0.0.1:443/</span></code>. <strong>NOTE:</strong> By default the Merlin agent will communicate on the loopback adapter.</p>
</div>
<div class="section" id="useragent">
<h2>UserAgent<a class="headerlink" href="#useragent" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-useragent</span></code> flag is the HTTP User-Agent header string that the Agent will use while sending traffic. The default value is: <code class="docutils literal notranslate"><span class="pre">Mozilla/5.0</span> <span class="pre">(Windows</span> <span class="pre">NT</span> <span class="pre">6.1;</span> <span class="pre">Win64;</span> <span class="pre">x64)</span> <span class="pre">AppleWebKit/537.36</span> <span class="pre">(KHTML,</span> <span class="pre">like</span> <span class="pre">Gecko)</span> <span class="pre">Chrome/40.0.2214.85</span> <span class="pre">Safari/537.36</span></code>.</p>
</div>
<div class="section" id="verbose">
<h2>Verbose<a class="headerlink" href="#verbose" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-v</span></code> flag enables verbose output. By default a running Merlin Agent will not write any information to STDOUT. This can be used to see what the agent is doing along with what commands it is receiving.</p>
</div>
<div class="section" id="version">
<h2>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">-version</span></code> flag will print the Agent version to the screen and then exit.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dll.html" class="btn btn-neutral float-right" title="DLL Agent" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../quickStart/faq.html" class="btn btn-neutral float-left" title="FAQ" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Russel Van Tuyl (@Ne0nd0g)

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>